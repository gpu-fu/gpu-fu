!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.beta=n():e.beta=n()}("undefined"!=typeof self?self:this,(()=>(()=>{"use strict";var e={};(e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})})(e);var n=function(){function e(e,n){this._store=[],this._storeIndex=0,this._storeUnits=[],this._storeUnitsIndex=0,this._storeGPUActions=[],this._storeGPUActionsIndex=0,this._needsUnitReRun=!0,this._unitFn=e,this.device=n}return e.prototype._nextStoreIndex=function(){var e=this._storeIndex;return this._storeIndex=e+1,e},e.prototype._nextStoreUnitsIndex=function(){var e=this._storeUnitsIndex;return this._storeUnitsIndex=e+1,e},e.prototype._nextStoreGPUActionsIndex=function(){var e=this._storeGPUActionsIndex;return this._storeGPUActionsIndex=e+1,e},e.prototype.runUnitIfNeeded=function(e){var n=!1;return this._storeUnits.forEach((function(e){var t=e();(null==t?void 0:t._ctx.runUnitIfNeeded(t))&&(n=!0)})),!(!this._needsUnitReRun&&!n||(this._storeIndex=0,this._storeUnitsIndex=0,this._storeGPUActionsIndex=0,this._needsUnitReRun=!1,Object.assign(e,this._unitFn(this)),0))},e.prototype.runGPUActionsIfNeeded=function(e){var n=this;this._storeUnits.forEach((function(n){var t=n();null==t||t._ctx.runGPUActionsIfNeeded(e)})),this.commandEncoder=e,this._storeGPUActions.forEach((function(e,t){var r=e[0];e[1],e[2]&&(r(n),n._storeGPUActions[t][2]=!1)})),this.commandEncoder=void 0},e.prototype._useProp=function(e){var n=this._nextStoreIndex(),t=this._store[n];if(t)return t;var r=this,o="function"==typeof e?e():e,i=function(){return o};return i.set=function(e){o!==e&&(o=e,r._needsUnitReRun=!0)},i.change=function(e){var n=e(o);o!==n&&(o=n,r._needsUnitReRun=!0)},i.mutate=function(e){e(o),r._needsUnitReRun=!0},this._store[n]=i,i},e.prototype._useUnitProp=function(e){var n=this._nextStoreUnitsIndex(),t=this._storeUnits[n];if(t)return t;var r=this,o="function"==typeof e?e():e,i=function(){return o};return i.set=function(e){o!==e&&(o=e,r._needsUnitReRun=!0)},i.change=function(e){var n=e(o);o!==n&&(o=n,r._needsUnitReRun=!0)},i.mutate=function(e){e(o),r._needsUnitReRun=!0},this._storeUnits[n]=i,i},e.prototype._useGPUResource=function(e,n){var t=this._nextStoreIndex(),r=this._store[t];if(!r){var o=e(this);return this._store[t]=[o,n],o}if(n.every((function(e,n){return e===r[1][n]})))return r[0];var i=e(this),u=r[0];return r[0]=i,r[1]=n,u&&"function"==typeof u.destroy&&u.destroy(),i},e.prototype._useGPUAction=function(e,n){var t=this._nextStoreGPUActionsIndex(),r=this._storeGPUActions[t];r?n.every((function(e,n){return e===r[1][n]}))||(r[0]=e,r[1]=n,r[2]=!0):this._storeGPUActions[t]=[e,n,!0]},e.prototype._useEffect=function(e,n){var t=this._nextStoreIndex(),r=this._store[t];if(r)n.every((function(e,n){return e===r[1][n]}))||(r[0]&&r[0](),r[0]=e({}),r[1]=n);else{var o=e({});this._store[t]=[o,n]}},e}(),t=function(){return t=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e},t.apply(this,arguments)};const r=function(){function e(e){this._renders=[],this._canvasContext=e}return e.prototype.addRender=function(e){this._renders.includes(e)||this._renders.push(e)},e.prototype.outputFrame=function(e){var n=this._canvasContext.getCurrentTexture();this._renders.forEach((function(t){t.renderTarget.set(n),t.runFrame(e)}))},e}();var o=function(e,n,t,r){return new(t||(t=Promise))((function(o,i){function u(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(u,s)}c((r=r.apply(e,n||[])).next())}))},i=function(e,n){var t,r,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(t)throw new TypeError("Generator is already executing.");for(;u;)try{if(t=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,r=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!((o=(o=u.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=n.call(e,u)}catch(e){i=[6,e],r=0}finally{t=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};function u(e){return void 0===e&&(e="high-performance"),o(this,void 0,void 0,(function(){var n;return i(this,(function(t){switch(t.label){case 0:if(!navigator.gpu)throw new Error("Your browser doesn't have WebGPU enabled!");return[4,navigator.gpu.requestAdapter({powerPreference:e})];case 1:if(!(n=t.sent()))throw new Error("Failed to get the GPU adapter!");return[2,n.requestDevice()]}}))}))}function s(){var e=document.querySelector("canvas.main");if(!e)throw new Error("The main canvas wasn't found in the HTML!");return e}function c(e,n){return o(this,void 0,void 0,(function(){var t;return i(this,(function(r){if(!(t=e.getContext("webgpu")))throw new Error("Failed to get a WebGPU canvas context!");return t.configure({device:n,format:a(),alphaMode:"opaque"}),[2,t]}))}))}function a(){var e,n,t=null===(n=null===(e=navigator.gpu)||void 0===e?void 0:e.getPreferredCanvasFormat)||void 0===n?void 0:n.bind(navigator.gpu);return t?t():"rgba8unorm"}const f="@stage(vertex)\nfn vertexRenderColoredTriangle(\n  @builtin(vertex_index) index: u32\n) ->\n  @builtin(position) vec4<f32>\n{\n  let triangle = array<vec2<f32>, 3>(\n    vec2<f32>(0.0, 0.433),\n    vec2<f32>(-0.5, -0.433),\n    vec2<f32>(0.5, -0.433),\n  );\n\n  return vec4<f32>(triangle[index], 0.0, 1.0);\n}\n\n@stage(fragment)\nfn fragmentRenderColoredTriangle(\n  @builtin(position) pos_in: vec4<f32>\n) ->\n  @location(0) vec4<f32>\n{\n  return vec4<f32>(\n    pos_in.x * 0.003,\n    pos_in.y * 0.003,\n    1.0 - (pos_in.y * 0.003),\n    1.0,\n  );\n}\n";var d;return d=function(e){var n=function(e){return e._useProp(void 0)}(e),t=function(e,n,t){return e._useGPUResource((function(e){return e.device.createRenderPipeline({vertex:{module:e.device.createShaderModule({code:f}),entryPoint:"vertexRenderColoredTriangle"},fragment:{module:e.device.createShaderModule({code:f}),entryPoint:"fragmentRenderColoredTriangle",targets:[{format:"rgba8unorm"}]},primitive:{topology:"triangle-list"},layout:void 0})}),[])}(e);return function(e,r,o){e._useGPUAction((function(e){var r=n();if(r){var o=e.commandEncoder.beginRenderPass({colorAttachments:[{view:r.createView(),clearValue:{r:0,g:0,b:0,a:1},loadOp:"clear",storeOp:"store"}]});o.setPipeline(t),o.draw(3,1,0,0),o.end()}}),o)}(e,0,[n()]),{renderTarget:n}},function(e){o(this,void 0,void 0,(function(){function e(){!function(e,n){var t=e.createCommandEncoder();n(t),e.queue.submit([t.finish()])}(o,f),requestAnimationFrame(e)}var o,a,f;return i(this,(function(i){switch(i.label){case 0:return[4,u()];case 1:return o=i.sent(),[4,c(s(),o)];case 2:return a=i.sent(),f=function(e,o){var i=function(e,r){var o=new n(r,e),i=t(t({},r(o)),{_ctx:o});return i.runFrame=function(e){return function(e,n){var t=e._ctx;t.runUnitIfNeeded(e),t.runGPUActionsIfNeeded(n)}(i,e)},i}(e,d),u=new r(o);return u.addRender(i),function(e){u.outputFrame(e)}}(o,a),requestAnimationFrame(e),[2]}}))})).catch((function(e){document.querySelector("body").innerHTML=e,console.error(e)}))}(),e})()));
//# sourceMappingURL=demo1.js.map